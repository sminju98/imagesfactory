# ê¸°ìˆ  ëª…ì„¸ì„œ (Technical Specification)
# imagesfactory

**ë¬¸ì„œ ë²„ì „**: 2.0  
**ì‘ì„±ì¼**: 2025-11-23  
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-01  
**ëŒ€ìƒ ë…ì**: ê°œë°œíŒ€, DevOps  
**ìƒíƒœ**: ì—…ë°ì´íŠ¸ë¨

---

## ğŸ“‹ ê°œìš”

ë³¸ ë¬¸ì„œëŠ” imagesfactoryì˜ ê¸°ìˆ  ì•„í‚¤í…ì²˜, ê¸°ìˆ  ìŠ¤íƒ, ê°œë°œ í™˜ê²½, ë°°í¬ ì „ëµì„ ì •ì˜í•©ë‹ˆë‹¤.

---

## ğŸ— ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CDN (Cloudflare)             â”‚
â”‚     (ì •ì  íŒŒì¼, ì´ë¯¸ì§€ ìºì‹±)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Next.js (Vercel/AWS)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (React)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routes (Backend)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚        â”‚          â”‚          â”‚
    â†“        â†“          â†“          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL â”‚Redisâ”‚ AWS S3 â”‚ â”‚AI APIs â”‚
â”‚           â”‚     â”‚        â”‚ â”‚        â”‚
â”‚  (Vercel) â”‚(Up- â”‚(Storage)â”‚ â”‚DALL-E  â”‚
â”‚  Postgres â”‚stash)â”‚        â”‚ â”‚Stable  â”‚
â”‚           â”‚     â”‚        â”‚ â”‚Diffusionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   SendGrid  â”‚
             â”‚   (Email)   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì´ì–´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Presentation Layer (UI)          â”‚
â”‚    - Next.js Pages/Components       â”‚
â”‚    - React Hooks                    â”‚
â”‚    - Zustand (State Management)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    API Layer                        â”‚
â”‚    - Next.js API Routes             â”‚
â”‚    - REST API Endpoints             â”‚
â”‚    - Middleware (Auth, Rate Limit)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Business Logic Layer             â”‚
â”‚    - Services                       â”‚
â”‚    - Use Cases                      â”‚
â”‚    - Domain Models                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Data Access Layer                â”‚
â”‚    - Prisma ORM                     â”‚
â”‚    - Redis Cache                    â”‚
â”‚    - S3 Client                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» ê¸°ìˆ  ìŠ¤íƒ

### Frontend

#### Core
- **Next.js**: 14.2+ (App Router)
  - ì´ìœ : SSR, API Routes í†µí•©, ìµœì í™”
- **React**: 18+
- **TypeScript**: 5.0+
  - íƒ€ì… ì•ˆì •ì„±, ê°œë°œ ìƒì‚°ì„±

#### UI/UX
- **Tailwind CSS**: 3.4+
  - ë¹ ë¥¸ ìŠ¤íƒ€ì¼ë§, ì¼ê´€ì„±
- **shadcn/ui**: ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
  - ì ‘ê·¼ì„±, ì»¤ìŠ¤í„°ë§ˆì´ì§•
- **Radix UI**: í—¤ë“œë¦¬ìŠ¤ ì»´í¬ë„ŒíŠ¸
- **Lucide React**: ì•„ì´ì½˜
- **Framer Motion**: ì• ë‹ˆë©”ì´ì…˜

#### í¼ & ê²€ì¦
- **React Hook Form**: í¼ ê´€ë¦¬
- **Zod**: ìŠ¤í‚¤ë§ˆ ê²€ì¦
  - íƒ€ì… ì•ˆì „ì„±, ëŸ°íƒ€ì„ ê²€ì¦

#### ìƒíƒœ ê´€ë¦¬
- **Zustand**: ì „ì—­ ìƒíƒœ
  - ê°€ë³ê³  ê°„ë‹¨
- **TanStack Query (React Query)**: ì„œë²„ ìƒíƒœ
  - ìºì‹±, ìë™ ë¦¬íŒ¨ì¹˜

#### ê¸°íƒ€
- **Axios**: HTTP í´ë¼ì´ì–¸íŠ¸
- **date-fns**: ë‚ ì§œ ì²˜ë¦¬
- **react-dropzone**: íŒŒì¼ ì—…ë¡œë“œ
- **recharts**: ì°¨íŠ¸ (ëŒ€ì‹œë³´ë“œ)

### Backend

#### Core
- **Node.js**: 20 LTS
- **Next.js API Routes**: ì„œë²„ë¦¬ìŠ¤ API
- **TypeScript**: 5.0+

#### ë°ì´í„°ë² ì´ìŠ¤
- **PostgreSQL**: 16+
  - ê´€ê³„í˜• ë°ì´í„°, ACID
- **Prisma ORM**: 4.0+
  - íƒ€ì… ì•ˆì „, ë§ˆì´ê·¸ë ˆì´ì…˜

#### ìºì‹œ & Queue
- **Redis**: 7+
  - ì„¸ì…˜, ìºì‹œ, Queue
- **BullMQ**: Queue ê´€ë¦¬
  - ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…, ì¬ì‹œë„

#### ì¸ì¦
- **NextAuth.js (Auth.js)**: v5
  - ì´ë©”ì¼/êµ¬ê¸€ ë¡œê·¸ì¸ í†µí•©
- **bcryptjs**: ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
- **jsonwebtoken**: JWT ìƒì„±/ê²€ì¦

#### ì™¸ë¶€ API
- **OpenAI API**: DALL-E 3, GPT-4o-mini, GPT-5.1-mini (í”„ë¡¬í”„íŠ¸ êµì •, ì½˜ì…‰íŠ¸ ìƒì„±)
- **Perplexity API**: ì›¹ ê²€ìƒ‰ ê¸°ë°˜ ë¦¬ì„œì¹˜ (Content Factory, Reels Factory)
- **xAI (Grok)**: ëŒ€ë³¸ ìƒì„± (Reels Factory)
- **Google Veo3**: ì˜ìƒ ìƒì„± (Reels Factory, ê°œë°œ ì¤‘)
- **Pixazo**: TTS ìŒì„± í•©ì„± (Reels Factory, ê°œë°œ ì¤‘)
- **Stability AI API**: Stable Diffusion
- **Replicate API**: ë‹¤ì–‘í•œ AI ëª¨ë¸ (Flux, Realistic Vision, SDXL ë“±)
- **Google Cloud Translation**: í”„ë¡¬í”„íŠ¸ ë²ˆì—­
- **SendGrid**: ì´ë©”ì¼ ì „ì†¡
- **Toss Payments**: ê²°ì œ

#### íŒŒì¼ ìŠ¤í† ë¦¬ì§€
- **Firebase Storage**: ì´ë¯¸ì§€/ì˜ìƒ ì €ì¥
- **Sharp**: ì´ë¯¸ì§€ ì²˜ë¦¬ (ì¸ë„¤ì¼, ë©”íƒ€ë°ì´í„° ì¡°ì‘)
  - PNG ë©”íƒ€ë°ì´í„° ì½ê¸°/ì“°ê¸° (í”„ë¡¬í”„íŠ¸ íˆìŠ¤í† ë¦¬ ì €ì¥)
  - EXIF/tEXt ì²­í¬ í™œìš©
- **FFmpeg**: ì˜ìƒ ì²˜ë¦¬ (Reels Factory)
  - ì˜ìƒ ê²°í•© (Concat)
  - ìŒì„± í•©ì„±
  - ìë§‰ ì¶”ê°€

#### ë³´ì•ˆ
- **helmet**: HTTP ë³´ì•ˆ í—¤ë”
- **express-rate-limit**: Rate limiting
- **cors**: CORS ì„¤ì •
- **validator**: ì…ë ¥ ê²€ì¦

### DevOps & ì¸í”„ë¼

#### í˜¸ìŠ¤íŒ…
- **Vercel**: Frontend + API (ìš°ì„ )
  - ì¥ì : Zero-config, ìë™ ë°°í¬
- **AWS** (ëŒ€ì•ˆ): EC2, RDS, S3
  - ì¥ì : ë” ë§ì€ ì œì–´

#### CI/CD
- **GitHub Actions**: ìë™í™”
  - í…ŒìŠ¤íŠ¸, ë¹Œë“œ, ë°°í¬
- **Vercel Git Integration**: ìë™ ë°°í¬

#### ëª¨ë‹ˆí„°ë§
- **Sentry**: ì—ëŸ¬ íŠ¸ë˜í‚¹
- **Vercel Analytics**: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- **LogTail** ë˜ëŠ” **Datadog**: ë¡œê·¸ ê´€ë¦¬

#### í…ŒìŠ¤íŒ…
- **Jest**: ìœ ë‹› í…ŒìŠ¤íŠ¸
- **React Testing Library**: ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
- **Playwright**: E2E í…ŒìŠ¤íŠ¸
- **k6** ë˜ëŠ” **Artillery**: ë¶€í•˜ í…ŒìŠ¤íŠ¸

---

## ğŸ—‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
imagesfactory/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (auth)/            # ì¸ì¦ ê´€ë ¨ í˜ì´ì§€
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ (dashboard)/       # ë¡œê·¸ì¸ í•„ìš” í˜ì´ì§€
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ create/
â”‚   â”‚   â”‚   â”œâ”€â”€ history/
â”‚   â”‚   â”‚   â”œâ”€â”€ points/
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”œâ”€â”€ content/       # Content Factory
â”‚   â”‚   â”‚   â”œâ”€â”€ reels/         # Reels Factory (ê°œë°œ ì¤‘)
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”œâ”€â”€ api/               # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ generate/
â”‚   â”‚   â”‚   â”œâ”€â”€ content/       # Content Factory API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ generate-concept/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ generate-message/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ generate-script/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ generate-copy/
â”‚   â”‚   â”‚   â”œâ”€â”€ reels/         # Reels Factory API (ê°œë°œ ì¤‘)
â”‚   â”‚   â”‚   â”œâ”€â”€ gallery/       # ê°¤ëŸ¬ë¦¬ API
â”‚   â”‚   â”‚   â”œâ”€â”€ points/
â”‚   â”‚   â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # Root Layout
â”‚   â”‚   â”œâ”€â”€ page.tsx           # ëœë”© í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ components/            # React ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ ui/               # shadcn/ui ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ auth/             # ì¸ì¦ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ image-factory/     # ì´ë¯¸ì§€ ìƒì„± ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ content-factory/   # Content Factory ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ ContentFactoryMain.tsx
â”‚   â”‚   â”‚   â””â”€â”€ steps/
â”‚   â”‚   â”œâ”€â”€ reels-factory/     # Reels Factory ì»´í¬ë„ŒíŠ¸ (ê°œë°œ ì¤‘)
â”‚   â”‚   â”œâ”€â”€ gallery/           # ê°¤ëŸ¬ë¦¬ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ layout/           # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ shared/           # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ lib/                   # ìœ í‹¸ë¦¬í‹° & ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ firebase.ts       # Firebase ì´ˆê¸°í™”
â”‚   â”‚   â”œâ”€â”€ firebase-admin.ts # Firebase Admin SDK
â”‚   â”‚   â”œâ”€â”€ perplexity.ts     # Perplexity API ìœ í‹¸
â”‚   â”‚   â”œâ”€â”€ ai-models.ts      # AI ëª¨ë¸ í†µí•©
â”‚   â”‚   â”œâ”€â”€ translate.ts      # ë²ˆì—­ ìœ í‹¸
â”‚   â”‚   â””â”€â”€ utils.ts          # ìœ í‹¸ í•¨ìˆ˜
â”‚   â”œâ”€â”€ services/              # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ content.service.ts # Content Factory ì„œë¹„ìŠ¤
â”‚   â”‚   â””â”€â”€ reels.service.ts   # Reels Factory ì„œë¹„ìŠ¤ (ê°œë°œ ì¤‘)
â”‚   â”‚   â”œâ”€â”€ generation.service.ts
â”‚   â”‚   â”œâ”€â”€ point.service.ts
â”‚   â”‚   â”œâ”€â”€ payment.service.ts
â”‚   â”‚   â””â”€â”€ ai.service.ts
â”‚   â”œâ”€â”€ workers/               # ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
â”‚   â”‚   â”œâ”€â”€ image-generation.worker.ts
â”‚   â”‚   â””â”€â”€ email.worker.ts
â”‚   â”œâ”€â”€ types/                 # TypeScript íƒ€ì…
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ models.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ hooks/                 # Custom React Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useGeneration.ts
â”‚   â”‚   â””â”€â”€ usePoints.ts
â”‚   â”œâ”€â”€ store/                 # Zustand Store
â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â””â”€â”€ uiStore.ts
â”‚   â””â”€â”€ middleware.ts          # Next.js Middleware
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma         # DB ìŠ¤í‚¤ë§ˆ
â”‚   â”œâ”€â”€ migrations/           # ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚   â””â”€â”€ seed.ts               # ì‹œë“œ ë°ì´í„°
â”œâ”€â”€ public/                    # ì •ì  íŒŒì¼
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ icons/
â”œâ”€â”€ tests/                     # í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”œâ”€â”€ docs/                      # ë¬¸ì„œ
â”œâ”€â”€ .env.example              # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ .env.local                # ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸ”§ ê°œë°œ í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ì†Œí”„íŠ¸ì›¨ì–´
- Node.js: 20 LTS
- pnpm: 8+ (íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €)
- PostgreSQL: 16+ (ë¡œì»¬ ê°œë°œ)
- Redis: 7+ (ë¡œì»¬ ê°œë°œ)
- Git

### í™˜ê²½ ë³€ìˆ˜

#### .env.local (ê°œë°œ)
```bash
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/imagesfactory"

# Redis
REDIS_URL="redis://localhost:6379"

# NextAuth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key-min-32-chars"

# Google OAuth
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# AI APIs
OPENAI_API_KEY="sk-..."
STABILITY_API_KEY="sk-..."

# AWS S3
AWS_ACCESS_KEY_ID="your-access-key"
AWS_SECRET_ACCESS_KEY="your-secret-key"
AWS_REGION="ap-northeast-2"
AWS_S3_BUCKET="imagesfactory-dev"

# SendGrid
SENDGRID_API_KEY="SG...."
SENDGRID_FROM_EMAIL="noreply@imagesfactory.com"

# Toss Payments
TOSS_CLIENT_KEY="test_ck_..."
TOSS_SECRET_KEY="test_sk_..."

# Google Translate
GOOGLE_TRANSLATE_API_KEY="your-key"

# Sentry (ì„ íƒ)
SENTRY_DSN="https://..."
```

#### .env.production (í”„ë¡œë•ì…˜)
```bash
# ìœ„ì™€ ë™ì¼í•˜ì§€ë§Œ í”„ë¡œë•ì…˜ í‚¤ ì‚¬ìš©
DATABASE_URL="postgresql://..."
REDIS_URL="rediss://..."
NEXTAUTH_URL="https://imagesfactory.com"
# ... (í”„ë¡œë•ì…˜ í‚¤)
```

### ë¡œì»¬ ê°œë°œ ì‹œì‘

```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/your-org/imagesfactory.git
cd imagesfactory

# ì˜ì¡´ì„± ì„¤ì¹˜
pnpm install

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env.local
# .env.local í¸ì§‘

# ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
pnpm prisma migrate dev

# ì‹œë“œ ë°ì´í„° (ì„ íƒ)
pnpm prisma db seed

# ê°œë°œ ì„œë²„ ì‹œì‘
pnpm dev

# Worker ì‹œì‘ (ë³„ë„ í„°ë¯¸ë„)
pnpm worker:dev
```

---

## ğŸ¨ API ì„¤ê³„ ì›ì¹™

### RESTful API
- HTTP ë©”ì„œë“œ ì˜ë¯¸ë¡ ì  ì‚¬ìš©
  - GET: ì¡°íšŒ
  - POST: ìƒì„±
  - PUT/PATCH: ìˆ˜ì •
  - DELETE: ì‚­ì œ
- ëª…ì‚¬ ê¸°ë°˜ URL
  - âœ… `/api/generate`
  - âŒ `/api/createImage`
- ë³µìˆ˜í˜• ì‚¬ìš©
  - `/api/users` (ëª©ë¡)
  - `/api/users/:id` (ë‹¨ì¼)

### ì‘ë‹µ í˜•ì‹

#### ì„±ê³µ ì‘ë‹µ
```typescript
{
  success: true,
  data: {
    // ì‹¤ì œ ë°ì´í„°
  },
  meta?: {
    page: 1,
    limit: 20,
    total: 100
  }
}
```

#### ì—ëŸ¬ ì‘ë‹µ
```typescript
{
  success: false,
  error: {
    code: "INSUFFICIENT_POINTS",
    message: "í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.",
    details?: {
      required: 1000,
      current: 500
    }
  }
}
```

### HTTP ìƒíƒœ ì½”ë“œ
- 200: OK (ì„±ê³µ)
- 201: Created (ìƒì„± ì„±ê³µ)
- 204: No Content (ì„±ê³µ, ì‘ë‹µ ë³¸ë¬¸ ì—†ìŒ)
- 400: Bad Request (ì˜ëª»ëœ ìš”ì²­)
- 401: Unauthorized (ì¸ì¦ í•„ìš”)
- 403: Forbidden (ê¶Œí•œ ì—†ìŒ)
- 404: Not Found (ë¦¬ì†ŒìŠ¤ ì—†ìŒ)
- 409: Conflict (ì¶©ëŒ, ì˜ˆ: ì´ë©”ì¼ ì¤‘ë³µ)
- 422: Unprocessable Entity (ê²€ì¦ ì‹¤íŒ¨)
- 429: Too Many Requests (Rate limit)
- 500: Internal Server Error (ì„œë²„ ì—ëŸ¬)
- 503: Service Unavailable (ì„œë¹„ìŠ¤ ë¶ˆê°€)

---

## ğŸ”’ ë³´ì•ˆ ì„¤ê³„

### ì¸ì¦ í”Œë¡œìš°

#### ì´ë©”ì¼ ë¡œê·¸ì¸
```
1. ì‚¬ìš©ì â†’ POST /api/auth/login (email, password)
2. ì„œë²„: ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (bcrypt)
3. ì„œë²„: JWT ìƒì„± (ì•¡ì„¸ìŠ¤ + ë¦¬í”„ë ˆì‹œ)
4. ì„œë²„: ë¦¬í”„ë ˆì‹œ í† í° Redis ì €ì¥
5. ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: í† í° ë°˜í™˜ (HttpOnly ì¿ í‚¤)
6. í´ë¼ì´ì–¸íŠ¸: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
```

#### êµ¬ê¸€ ë¡œê·¸ì¸
```
1. ì‚¬ìš©ì â†’ êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
2. NextAuth â†’ êµ¬ê¸€ OAuth í˜ì´ì§€
3. ì‚¬ìš©ì: êµ¬ê¸€ ì¸ì¦
4. êµ¬ê¸€ â†’ NextAuth: ì¸ì¦ ì½”ë“œ
5. NextAuth â†’ êµ¬ê¸€: í† í° êµí™˜
6. NextAuth: ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
7. NextAuth: DB ì¡°íšŒ/ìƒì„±
8. NextAuth: ì„¸ì…˜ ìƒì„±
9. í´ë¼ì´ì–¸íŠ¸: ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸
```

#### í† í° ê°±ì‹ 
```
1. ì•¡ì„¸ìŠ¤ í† í° ë§Œë£Œ (401 ì—ëŸ¬)
2. í´ë¼ì´ì–¸íŠ¸ â†’ POST /api/auth/refresh (ë¦¬í”„ë ˆì‹œ í† í°)
3. ì„œë²„: ë¦¬í”„ë ˆì‹œ í† í° ê²€ì¦ (Redis)
4. ì„œë²„: ìƒˆ ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰
5. ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: ìƒˆ í† í°
6. í´ë¼ì´ì–¸íŠ¸: ì›ë˜ ìš”ì²­ ì¬ì‹œë„
```

### ë³´ì•ˆ ì¡°ì¹˜

#### 1. Input Validation (ì…ë ¥ ê²€ì¦)
```typescript
// Zod ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ
const signupSchema = z.object({
  email: z.string().email(),
  password: z.string()
    .min(8, "ìµœì†Œ 8ì")
    .regex(/[a-zA-Z]/, "ì˜ë¬¸ í¬í•¨")
    .regex(/[0-9]/, "ìˆ«ì í¬í•¨"),
  name: z.string().min(2).max(50),
});
```

#### 2. XSS ë°©ì§€
- React: ìë™ ì´ìŠ¤ì¼€ì´í•‘
- DOMPurify: HTML ì½˜í…ì¸  sanitize
- Content Security Policy í—¤ë”

#### 3. CSRF ë°©ì§€
- NextAuth: CSRF í† í° ìë™ ì²˜ë¦¬
- SameSite ì¿ í‚¤ ì„¤ì •

#### 4. SQL Injection ë°©ì§€
- Prisma ORM: Parameterized queries

#### 5. Rate Limiting
```typescript
// ì˜ˆì‹œ: express-rate-limit
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15ë¶„
  max: 100, // ìµœëŒ€ 100 ìš”ì²­
  message: "ë„ˆë¬´ ë§ì€ ìš”ì²­ì…ë‹ˆë‹¤.",
});
```

#### 6. í”„ë¡¬í”„íŠ¸ í•„í„°ë§
```typescript
const BANNED_WORDS = [
  "ìš•ì„¤", "í­ë ¥", "ì„±ì ", // ...
];

function validatePrompt(prompt: string): boolean {
  const lowerPrompt = prompt.toLowerCase();
  return !BANNED_WORDS.some(word => 
    lowerPrompt.includes(word)
  );
}
```

---

## ğŸ“¡ ì´ë¯¸ì§€ ìƒì„± ì›Œí¬í”Œë¡œìš°

### Queue ê¸°ë°˜ ì²˜ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì ìš”ì²­  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route       â”‚
â”‚  1. ê²€ì¦          â”‚
â”‚  2. í¬ì¸íŠ¸ ì°¨ê°   â”‚
â”‚  3. DB ë ˆì½”ë“œ ìƒì„±â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BullMQ Queue    â”‚
â”‚  ì‘ì—… ì¶”ê°€        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker          â”‚
â”‚  ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ (ë°˜ë³µ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI API í˜¸ì¶œ (1ì¥ì”©)      â”‚
â”‚ 1. DALL-E/SD API í˜¸ì¶œ   â”‚
â”‚ 2. ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ        â”‚
â”‚ 3. S3 ì—…ë¡œë“œ             â”‚
â”‚ 4. ì¸ë„¤ì¼ ìƒì„±            â”‚
â”‚ 5. DB ì €ì¥               â”‚
â”‚ 6. ì§„í–‰ë¥  ì—…ë°ì´íŠ¸        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ (ëª¨ë‘ ì™„ë£Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ZIP ìƒì„±     â”‚
â”‚  2. S3 ì—…ë¡œë“œ    â”‚
â”‚  3. ì´ë©”ì¼ ë°œì†¡   â”‚
â”‚  4. ìƒíƒœ ì™„ë£Œ ë³€ê²½â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Worker êµ¬í˜„ ì˜ˆì‹œ

```typescript
// workers/image-generation.worker.ts
import { Worker, Job } from 'bullmq';
import { generateImage } from '@/services/ai.service';
import { uploadToS3 } from '@/lib/s3';
import { prisma } from '@/lib/prisma';

interface GenerationJob {
  generationId: string;
  prompt: string;
  imageCount: number;
  style: string;
  aspectRatio: string;
}

const worker = new Worker(
  'image-generation',
  async (job: Job<GenerationJob>) => {
    const { generationId, prompt, imageCount, style, aspectRatio } = job.data;
    
    try {
      // ìƒíƒœ ì—…ë°ì´íŠ¸: PROCESSING
      await prisma.imageGeneration.update({
        where: { id: generationId },
        data: { status: 'PROCESSING' },
      });
      
      for (let i = 0; i < imageCount; i++) {
        // ì´ë¯¸ì§€ ìƒì„±
        const imageBuffer = await generateImage({
          prompt,
          style,
          aspectRatio,
        });
        
        // S3 ì—…ë¡œë“œ
        const imageUrl = await uploadToS3(imageBuffer, `${generationId}/${i}.png`);
        
        // ì¸ë„¤ì¼ ìƒì„±
        const thumbnailBuffer = await createThumbnail(imageBuffer);
        const thumbnailUrl = await uploadToS3(thumbnailBuffer, `${generationId}/${i}_thumb.png`);
        
        // DB ì €ì¥
        await prisma.image.create({
          data: {
            generationId,
            imageUrl,
            thumbnailUrl,
            order: i + 1,
            width: 1024,
            height: 1024,
          },
        });
        
        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        const progress = Math.round(((i + 1) / imageCount) * 100);
        await prisma.imageGeneration.update({
          where: { id: generationId },
          data: { progress },
        });
        
        // Job progress ì—…ë°ì´íŠ¸ (BullMQ)
        await job.updateProgress(progress);
      }
      
      // ZIP ìƒì„± ë° ì´ë©”ì¼ ë°œì†¡
      await createZipAndSendEmail(generationId);
      
      // ìƒíƒœ ì—…ë°ì´íŠ¸: COMPLETED
      await prisma.imageGeneration.update({
        where: { id: generationId },
        data: { 
          status: 'COMPLETED',
          completedAt: new Date(),
        },
      });
      
    } catch (error) {
      // ì‹¤íŒ¨ ì²˜ë¦¬
      await prisma.imageGeneration.update({
        where: { id: generationId },
        data: { 
          status: 'FAILED',
          failedReason: error.message,
        },
      });
      
      // í¬ì¸íŠ¸ í™˜ë¶ˆ
      await refundPoints(generationId);
      
      throw error;
    }
  },
  {
    connection: redisConnection,
    concurrency: 5, // ë™ì‹œ ì²˜ë¦¬ ìˆ˜
    limiter: {
      max: 10, // ìµœëŒ€ 10ê°œ
      duration: 1000, // 1ì´ˆë‹¹
    },
  }
);

worker.on('completed', (job) => {
  console.log(`Job ${job.id} completed`);
});

worker.on('failed', (job, err) => {
  console.error(`Job ${job?.id} failed:`, err);
});
```

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

### ì¸ë±ìŠ¤ ì „ëµ

```prisma
// User
@@index([email]) // ë¡œê·¸ì¸ ì¡°íšŒ
@@index([provider, providerId]) // ì†Œì…œ ë¡œê·¸ì¸

// ImageGeneration
@@index([userId, createdAt(sort: Desc)]) // íˆìŠ¤í† ë¦¬ ì¡°íšŒ
@@index([status]) // ìƒíƒœë³„ ì¡°íšŒ
@@index([createdAt]) // ë‚ ì§œ ë²”ìœ„ ì¡°íšŒ

// Image
@@index([generationId]) // ìƒì„±ë³„ ì´ë¯¸ì§€ ì¡°íšŒ

// PointTransaction
@@index([userId, createdAt(sort: Desc)]) // ê±°ë˜ ë‚´ì—­
@@index([type]) // ìœ í˜•ë³„ ì¡°íšŒ

// Payment
@@index([userId, createdAt(sort: Desc)]) // ê²°ì œ ë‚´ì—­
@@index([status]) // ìƒíƒœë³„ ì¡°íšŒ
@@index([paymentKey]) // í† ìŠ¤ ì¡°íšŒ
```

### ì¿¼ë¦¬ ìµœì í™”

#### N+1 ë¬¸ì œ ë°©ì§€
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: N+1 ì¿¼ë¦¬
const generations = await prisma.imageGeneration.findMany({
  where: { userId },
});
for (const gen of generations) {
  const images = await prisma.image.findMany({
    where: { generationId: gen.id },
  });
}

// âœ… ì¢‹ì€ ì˜ˆ: includeë¡œ í•œ ë²ˆì—
const generations = await prisma.imageGeneration.findMany({
  where: { userId },
  include: {
    images: true,
  },
});
```

#### í˜ì´ì§€ë„¤ì´ì…˜
```typescript
// Cursor ê¸°ë°˜ (ê¶Œì¥)
const generations = await prisma.imageGeneration.findMany({
  take: 20,
  skip: cursor ? 1 : 0,
  cursor: cursor ? { id: cursor } : undefined,
  orderBy: { createdAt: 'desc' },
});

// Offset ê¸°ë°˜ (ë‹¨ìˆœ)
const generations = await prisma.imageGeneration.findMany({
  take: 20,
  skip: (page - 1) * 20,
  orderBy: { createdAt: 'desc' },
});
```

### ìºì‹± ì „ëµ

#### Redis ìºì‹œ
```typescript
// í¬ì¸íŠ¸ ì”ì•¡ ìºì‹±
async function getPoints(userId: string): Promise<number> {
  const cacheKey = `points:${userId}`;
  
  // ìºì‹œ í™•ì¸
  const cached = await redis.get(cacheKey);
  if (cached) return parseInt(cached);
  
  // DB ì¡°íšŒ
  const user = await prisma.user.findUnique({
    where: { id: userId },
    select: { points: true },
  });
  
  // ìºì‹œ ì €ì¥ (1ì‹œê°„)
  await redis.setex(cacheKey, 3600, user.points);
  
  return user.points;
}

// í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸ ì‹œ ìºì‹œ ë¬´íš¨í™”
async function updatePoints(userId: string, amount: number) {
  await prisma.user.update({
    where: { id: userId },
    data: { points: { increment: amount } },
  });
  
  // ìºì‹œ ì‚­ì œ
  await redis.del(`points:${userId}`);
}
```

---

## ğŸš€ ë°°í¬ ì „ëµ

### Vercel ë°°í¬ (ê¶Œì¥)

#### ì„¤ì •
```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['imagesfactory.s3.amazonaws.com'],
  },
  experimental: {
    serverActions: true,
  },
  env: {
    NEXT_PUBLIC_APP_URL: process.env.NEXTAUTH_URL,
  },
};
```

#### í™˜ê²½ë³„ ë°°í¬
- **Production**: `main` ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ ìë™ ë°°í¬
- **Preview**: PR ìƒì„± ì‹œ í”„ë¦¬ë·° í™˜ê²½ ìë™ ìƒì„±
- **Development**: `dev` ë¸Œëœì¹˜

#### Vercel ì„¤ì •
```json
{
  "buildCommand": "pnpm build",
  "outputDirectory": ".next",
  "installCommand": "pnpm install",
  "devCommand": "pnpm dev",
  "env": {
    // í™˜ê²½ ë³€ìˆ˜ (Vercel ëŒ€ì‹œë³´ë“œì—ì„œ ì„¤ì •)
  }
}
```

### AWS ë°°í¬ (ëŒ€ì•ˆ)

#### ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CloudFront   â”‚ (CDN)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ALB          â”‚ (ë¡œë“œ ë°¸ëŸ°ì„œ)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EC2 (x2)     â”‚ (Auto Scaling)
â”‚ - Next.js    â”‚
â”‚ - PM2        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RDS          â”‚ Elastic- â”‚  S3     â”‚
â”‚ (PostgreSQL) â”‚  Cache   â”‚         â”‚
â”‚              â”‚ (Redis)  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### EC2 ì„¤ì •
```bash
# Node.js ì„¤ì¹˜
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# pnpm ì„¤ì¹˜
npm install -g pnpm

# PM2 ì„¤ì¹˜
npm install -g pm2

# í”„ë¡œì íŠ¸ í´ë¡  ë° ë¹Œë“œ
git clone https://github.com/your-org/imagesfactory.git
cd imagesfactory
pnpm install
pnpm build

# PM2ë¡œ ì‹¤í–‰
pm2 start npm --name "imagesfactory" -- start
pm2 save
pm2 startup
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ
```
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   E2E  â”‚ (10%)
      â”‚        â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚Integrationâ”‚ (30%)
      â”‚   Tests    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚Unit Tests  â”‚ (60%)
      â”‚            â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìœ ë‹› í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
```typescript
// tests/unit/services/point.service.test.ts
import { describe, it, expect, beforeEach } from 'jest';
import { deductPoints, refundPoints } from '@/services/point.service';

describe('PointService', () => {
  describe('deductPoints', () => {
    it('í¬ì¸íŠ¸ ì°¨ê° ì„±ê³µ', async () => {
      const userId = 'test-user';
      const amount = 500;
      
      const result = await deductPoints(userId, amount, 'í…ŒìŠ¤íŠ¸');
      
      expect(result.success).toBe(true);
      expect(result.newBalance).toBe(500); // 1000 - 500
    });
    
    it('í¬ì¸íŠ¸ ë¶€ì¡± ì‹œ ì‹¤íŒ¨', async () => {
      const userId = 'test-user';
      const amount = 2000;
      
      await expect(
        deductPoints(userId, amount, 'í…ŒìŠ¤íŠ¸')
      ).rejects.toThrow('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤');
    });
  });
});
```

### í†µí•© í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
```typescript
// tests/integration/api/generate.test.ts
import { describe, it, expect } from 'jest';
import request from 'supertest';
import { app } from '@/app';

describe('POST /api/generate', () => {
  it('ì´ë¯¸ì§€ ìƒì„± ìš”ì²­ ì„±ê³µ', async () => {
    const response = await request(app)
      .post('/api/generate')
      .set('Authorization', `Bearer ${testToken}`)
      .send({
        prompt: 'a beautiful sunset',
        imageCount: 5,
        style: 'realistic',
        aspectRatio: '16:9',
      });
    
    expect(response.status).toBe(201);
    expect(response.body.success).toBe(true);
    expect(response.body.data.generation).toBeDefined();
  });
});
```

### E2E í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
```typescript
// tests/e2e/image-generation.spec.ts
import { test, expect } from '@playwright/test';

test('ì´ë¯¸ì§€ ìƒì„± í”Œë¡œìš°', async ({ page }) => {
  // ë¡œê·¸ì¸
  await page.goto('/login');
  await page.fill('input[name="email"]', 'test@example.com');
  await page.fill('input[name="password"]', 'password123');
  await page.click('button[type="submit"]');
  
  // ëŒ€ì‹œë³´ë“œ í™•ì¸
  await expect(page).toHaveURL('/dashboard');
  
  // ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
  await page.click('a[href="/create"]');
  
  // í”„ë¡¬í”„íŠ¸ ì…ë ¥
  await page.fill('textarea[name="prompt"]', 'a beautiful sunset');
  await page.selectOption('select[name="style"]', 'realistic');
  await page.fill('input[name="imageCount"]', '5');
  
  // ìƒì„± ìš”ì²­
  await page.click('button:has-text("ìƒì„±í•˜ê¸°")');
  
  // ì§„í–‰ í™”ë©´ í™•ì¸
  await expect(page.locator('text=ìƒì„± ì¤‘')).toBeVisible();
  
  // ì™„ë£Œ ëŒ€ê¸° (ìµœëŒ€ 5ë¶„)
  await page.waitForSelector('text=ì™„ë£Œ', { timeout: 300000 });
});
```

---

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ & ë¡œê¹…

### Sentry ì„¤ì •
```typescript
// sentry.client.config.ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
  beforeSend(event, hint) {
    // ë¯¼ê°í•œ ì •ë³´ í•„í„°ë§
    if (event.request?.headers) {
      delete event.request.headers['authorization'];
    }
    return event;
  },
});
```

### ë¡œê·¸ ë ˆë²¨
```typescript
enum LogLevel {
  ERROR = 'error',
  WARN = 'warn',
  INFO = 'info',
  DEBUG = 'debug',
}

// í”„ë¡œë•ì…˜: INFO ì´ìƒë§Œ
// ê°œë°œ: DEBUG ëª¨ë‘
```

### ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­
- API ì‘ë‹µ ì‹œê°„ (P50, P95, P99)
- ì—ëŸ¬ìœ¨
- ì´ë¯¸ì§€ ìƒì„± ì„±ê³µë¥ 
- Queue ëŒ€ê¸° ì‹œê°„
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì‹œê°„
- í¬ì¸íŠ¸ ê±°ë˜ëŸ‰
- ê²°ì œ ì„±ê³µë¥ 

---

## ğŸ“ ì½”ë“œ í’ˆì§ˆ

### ESLint ì„¤ì •
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'next/core-web-vitals',
    'plugin:@typescript-eslint/recommended',
    'prettier',
  ],
  rules: {
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/no-explicit-any': 'warn',
    'no-console': 'warn',
  },
};
```

### Prettier ì„¤ì •
```javascript
// .prettierrc.js
module.exports = {
  semi: true,
  trailingComma: 'es5',
  singleQuote: true,
  printWidth: 100,
  tabWidth: 2,
};
```

### Husky (Git Hooks)
```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "pnpm test"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ]
  }
}
```

---

**ë¬¸ì„œ ìŠ¹ì¸**
- [ ] Tech Lead
- [ ] DevOps
- [ ] Security Team

## ğŸ“ ìµœì‹  ê¸°ëŠ¥ ì¶”ê°€ (2025-12-01)

### ì™„ë£Œëœ ê¸°ëŠ¥
1. **Content Factory**: SNS ì½˜í…ì¸  ìë™ ì œì‘
   - ì½˜ì…‰íŠ¸ ìƒì„± (GPT + Perplexity)
   - ë©”ì‹œì§€ ìƒì„± (GPT + Perplexity)
   - ëŒ€ë³¸ ìƒì„± (Grok)
   - ì¹´í”¼ ìƒì„± (GPT)
   - í”„ë¡œë•ì…˜ ìë™í™”

2. **ì´ë¯¸ì§€ ì§„í™” ì‹œìŠ¤í…œ**
   - PNG ë©”íƒ€ë°ì´í„°ì— í”„ë¡¬í”„íŠ¸ íˆìŠ¤í† ë¦¬ ì €ì¥
   - ìµœëŒ€ 5ì„¸ëŒ€ê¹Œì§€ ëˆ„ì 
   - ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ í™œìš©

3. **ê°¤ëŸ¬ë¦¬ ê¸°ëŠ¥**
   - ì¢‹ì•„ìš”/ì¦ê²¨ì°¾ê¸°
   - ê°¤ëŸ¬ë¦¬ì—ì„œ ë ˆí¼ëŸ°ìŠ¤ ì´ë¯¸ì§€ ì„ íƒ
   - í˜ì´ì§€ë„¤ì´ì…˜

4. **Perplexity API í†µí•©**
   - ì½˜í…ì¸  ìƒì„± ì‹œ ìµœì‹  íŠ¸ë Œë“œ ê²€ìƒ‰
   - í‚¤ì›Œë“œ, í˜ì¸í¬ì¸íŠ¸, ì‹œì¥ ë™í–¥ ìˆ˜ì§‘

### ê°œë°œ ì¤‘ì¸ ê¸°ëŠ¥
1. **Reels Factory**: AI ê¸°ë°˜ ë¦´ìŠ¤ ìë™ ì œì‘
   - Step0: í”„ë¡¬í”„íŠ¸ êµì • (GPT)
   - Step1: ë¦¬ì„œì¹˜ (Perplexity)
   - Step2: ì½˜ì…‰íŠ¸ ê¸°íš (GPT)
   - Step3: ëŒ€ë³¸ ì‘ì„± (Grok)
   - Step4: ì˜ìƒ ì œì‘ (Veo3) - ê°œë°œ ì¤‘
   - Step5: ìŒì„± í•©ì„± (Pixazo) - ê°œë°œ ì¤‘
   - Step6: ìµœì¢… ê²°í•© (FFmpeg) - ê°œë°œ ì¤‘

### ì£¼ìš” ë³€ê²½ì‚¬í•­
- **ê²°ì œ**: ë¬´í†µì¥ì…ê¸ˆ ì œê±°, ì¹´ë“œ/ê°„í¸ê²°ì œë§Œ ì§€ì›
- **AI ëª¨ë¸**: Realistic Vision v5.1ë¡œ ìˆ˜ì •
- **Admin**: AI í¬ë ˆë”§ ì‹¤íŒ¨ ì²˜ë¦¬ ê°œì„ 
- **ë©”íƒ€ë°ì´í„°**: Sharp ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ PNG ë©”íƒ€ë°ì´í„° ì¡°ì‘

---

**ë¬¸ì„œ íˆìŠ¤í† ë¦¬**
- v1.0 (2025-11-23): ì´ˆì•ˆ ì‘ì„±
- v2.0 (2025-12-01): Content Factory, Reels Factory, ì´ë¯¸ì§€ ì§„í™” ì‹œìŠ¤í…œ, Perplexity í†µí•© ì¶”ê°€

