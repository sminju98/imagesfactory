# Short-form/Reels Content Factory ì œì•ˆì„œ

## ğŸ“‹ ê°œìš”

AI ê¸°ë°˜ ìˆí¼ ì½˜í…ì¸ (ë¦´ìŠ¤/ì‡¼ì¸ ) ìë™ ìƒì„± ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
ì‚¬ìš©ì ì…ë ¥ â†’ í”„ë¡¬í”„íŠ¸ êµì • â†’ ìŠ¤í¬ë¦½íŠ¸/ì”¬ ìƒì„± â†’ ë¹„ë””ì˜¤ ìƒì„± â†’ TTS â†’ ìë§‰ â†’ ìµœì¢… í•©ì„±ì˜ 7ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

---

## ğŸ”¥ í•µì‹¬ ì›ì¹™

### 1. ì‚¬ìš©ì í™•ì¸ í•„ìˆ˜
- **ëª¨ë“  ë‹¨ê³„ì—ì„œ ì‚¬ìš©ì í™•ì¸/ìˆ˜ì • í•„ìš”**
- ìë™ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ ê¸ˆì§€
- ê° ë‹¨ê³„ ë…ë¦½ì  ì‹¤í–‰

### 2. AI ëª¨ë¸ ë¶„ë¦¬
- **í…ìŠ¤íŠ¸ ì²˜ë¦¬**: LangChain ë˜ëŠ” ì§ì ‘ API
- **ë¹„ë””ì˜¤ ìƒì„±**: ì§ì ‘ HTTP í´ë¼ì´ì–¸íŠ¸ (LangChain ì‚¬ìš© ì•ˆ í•¨)
- **TTS/í•©ì„±**: ì§ì ‘ API í˜¸ì¶œ

---

## ğŸ“Š 7ë‹¨ê³„ ì‚¬ìš©ì í”Œë¡œìš°

### STEP 1: ì‚¬ìš©ì ì…ë ¥
- ì›ë³¸ í”„ë¡¬í”„íŠ¸ ì…ë ¥
- ì°¸ì¡° ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì„ íƒ)
- **ë°ì´í„°ë§Œ ì €ì¥, ì²˜ë¦¬ ì—†ìŒ**

### STEP 2: í”„ë¡¬í”„íŠ¸ êµì • (GPT-5-mini)
- GPT-5-minië¡œ í”„ë¡¬í”„íŠ¸ ì •ì œ/ìµœì í™” (ë¹ ë¥¸ ì‘ë‹µ)
- ì‚¬ìš©ìê°€ êµì •ëœ í”„ë¡¬í”„íŠ¸ í™•ì¸/ìˆ˜ì •
- **í™•ì¸ í›„ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰**

### STEP 3: ìŠ¤í¬ë¦½íŠ¸ + ì”¬ ìƒì„± (GPT-5.2)
- ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (ëª¨ë“  ë‚´ë ˆì´ì…˜ ì—°ê²°)
- 3-7ê°œ ì”¬ ìƒì„± (ê° 8ì´ˆ)
- ê° ì”¬: ë¹„ì£¼ì–¼ í”„ë¡¬í”„íŠ¸(ì˜ì–´) + ë‚´ë ˆì´ì…˜(í•œêµ­ì–´/ì˜ì–´)
- **ì‚¬ìš©ìê°€ ì”¬ë³„ë¡œ ìˆ˜ì •/í™•ì¸**

### STEP 4: ë¹„ë””ì˜¤ ìƒì„± (Gemini Veo3)
- ê° ì”¬ë³„ 8ì´ˆ ë¹„ë””ì˜¤ í´ë¦½ ìƒì„±
- **ë³‘ë ¬ ì²˜ë¦¬** (ë™ì‹œì— ì—¬ëŸ¬ ì”¬ ìƒì„±)
- ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3íšŒ)
- **ì‚¬ìš©ìê°€ ê° í´ë¦½ í™•ì¸/ì¬ìƒì„±**

### STEP 5: TTS ìƒì„± (OpenAI TTS)
- ê° ì”¬ ë‚´ë ˆì´ì…˜ â†’ ìŒì„± ë³€í™˜
- ìŒì„± ì„ íƒ ê°€ëŠ¥ (alloy, echo, fable, onyx, nova, shimmer)
- **ë³‘ë ¬ ì²˜ë¦¬**
- **ì‚¬ìš©ìê°€ ìŒì„± í™•ì¸/ì¬ìƒì„±**

### STEP 6: ìë§‰ ìƒì„± + íƒ€ì´ë° (GPT-5-mini)
- TTS ì˜¤ë””ì˜¤ ê¸¸ì´ ê¸°ë°˜ ìë§‰ íƒ€ì´ë°
- GPT-5-minië¡œ ë¬¸ì¥ ë¶„í•  ìµœì í™” (ë¹ ë¥¸ ì‘ë‹µ)
- SRT/ASS í˜•ì‹ ì§€ì›
- **ì‚¬ìš©ìê°€ ìë§‰ í…ìŠ¤íŠ¸/íƒ€ì´ë° ìˆ˜ì •**

### STEP 7: ìµœì¢… í•©ì„± (FFmpeg)
- ë¹„ë””ì˜¤ + TTS + ìë§‰ í•©ì„±
- ëª¨ë“  í´ë¦½ ì—°ê²°
- Firebase Storage ì—…ë¡œë“œ
- **ìµœì¢… ì˜ìƒ ë‹¤ìš´ë¡œë“œ**

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### AI ëª¨ë¸ ì‚¬ìš©

| ë‹¨ê³„ | ëª¨ë¸ | ìš©ë„ | ë¹„ê³  |
|------|------|------|------|
| í”„ë¡¬í”„íŠ¸ êµì • | **GPT-5-mini** | í…ìŠ¤íŠ¸ ì •ì œ | ë¹ ë¥¸ ì‘ë‹µ |
| ìŠ¤í¬ë¦½íŠ¸/ì”¬ | **GPT-5.2** | í•œêµ­ì–´ í’ˆì§ˆ ìµœê³  | ì§ì ‘ API |
| ë¹„ë””ì˜¤ ìƒì„± | Gemini Veo3 | 8ì´ˆ í´ë¦½ ìƒì„± | ì§ì ‘ HTTP |
| TTS | OpenAI TTS | ìŒì„± í•©ì„± | ì§ì ‘ API |
| ìë§‰ íƒ€ì´ë° | **GPT-5-mini** | ë¬¸ì¥ ë¶„í•  | ë¹ ë¥¸ ì‘ë‹µ |
| ìµœì¢… í•©ì„± | FFmpeg | ì˜ìƒ í•©ì„± | ë¡œì»¬ ì‹¤í–‰ |

### ê¸°ìˆ  ìŠ¤íƒ
- **Frontend**: Next.js 14 (App Router) + TypeScript + Tailwind CSS
- **Backend**: Next.js API Routes
- **Database**: Firebase Firestore
- **Storage**: Firebase Storage
- **Video Processing**: FFmpeg

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ project/
â”‚       â”‚   â””â”€â”€ create/route.ts          # í”„ë¡œì íŠ¸ ìƒì„±
â”‚       â”œâ”€â”€ input/
â”‚       â”‚   â””â”€â”€ submit/route.ts          # Step 1: ì…ë ¥ ì €ì¥
â”‚       â”œâ”€â”€ prompt/
â”‚       â”‚   â”œâ”€â”€ correct/route.ts         # Step 2: GPT í”„ë¡¬í”„íŠ¸ êµì •
â”‚       â”‚   â””â”€â”€ confirm/route.ts         # Step 2: êµì • í™•ì¸
â”‚       â”œâ”€â”€ script/
â”‚       â”‚   â”œâ”€â”€ generate/route.ts        # Step 3: GPT-5.2 ìŠ¤í¬ë¦½íŠ¸/ì”¬
â”‚       â”‚   â””â”€â”€ confirm/route.ts         # Step 3: ì”¬ í™•ì¸
â”‚       â”œâ”€â”€ video/
â”‚       â”‚   â”œâ”€â”€ generate/route.ts        # Step 4: Veo3 ë¹„ë””ì˜¤ ìƒì„±
â”‚       â”‚   â”œâ”€â”€ select/route.ts          # Step 4: í´ë¦½ ì„ íƒ
â”‚       â”‚   â””â”€â”€ final-compose/route.ts   # Step 7: ìµœì¢… í•©ì„±
â”‚       â”œâ”€â”€ tts/
â”‚       â”‚   â”œâ”€â”€ generate/route.ts        # Step 5: TTS ìƒì„±
â”‚       â”‚   â””â”€â”€ confirm/route.ts         # Step 5: TTS í™•ì¸
â”‚       â””â”€â”€ subtitle/
â”‚           â”œâ”€â”€ generate/route.ts        # Step 6: ìë§‰ ìƒì„±
â”‚           â””â”€â”€ confirm/route.ts         # Step 6: ìë§‰ í™•ì¸
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ project/
â”‚       â”œâ”€â”€ gpt-prompt-corrector.ts      # GPT í”„ë¡¬í”„íŠ¸ êµì •
â”‚       â”œâ”€â”€ gpt-script-scene-generator.ts # GPT-5.2 ìŠ¤í¬ë¦½íŠ¸/ì”¬ ìƒì„±
â”‚       â”œâ”€â”€ veo-video-generator.ts       # Veo3 ë¹„ë””ì˜¤ ìƒì„±
â”‚       â”œâ”€â”€ tts-generator.ts             # OpenAI TTS
â”‚       â”œâ”€â”€ subtitle-engine.ts           # ìë§‰ ìƒì„± ì—”ì§„
â”‚       â”œâ”€â”€ final-video-composer.ts      # FFmpeg ìµœì¢… í•©ì„±
â”‚       â””â”€â”€ project-state-manager.ts     # ìƒíƒœ ê´€ë¦¬
â”‚
â””â”€â”€ types/
    â””â”€â”€ project.types.ts                 # íƒ€ì… ì •ì˜
```

---

## ğŸ“Š ë°ì´í„° ëª¨ë¸

### AIContentProject (Firestore)
```typescript
interface AIContentProject {
  id: string;
  userId: string;
  
  // Step 1: ì…ë ¥
  rawPrompt: string;
  referenceImageUrl?: string;
  
  // Step 2: í”„ë¡¬í”„íŠ¸ êµì •
  correctedPrompt?: string;
  confirmedPrompt?: string;
  
  // Step 3: ìŠ¤í¬ë¦½íŠ¸/ì”¬
  script?: string;
  scenes: Scene[];
  scriptFinal?: string;
  scenesFinal: Scene[];
  
  // Step 4: ë¹„ë””ì˜¤
  videoClips: VideoClip[];
  selectedVideoClips: string[];
  
  // Step 5: TTS
  ttsAudios: TTSAudio[];
  
  // Step 6: ìë§‰
  subtitles: Subtitle[];
  subtitlesFinal: Subtitle[];
  
  // Step 7: ìµœì¢…
  finalVideoUrl?: string;
  
  // ë©”íƒ€ë°ì´í„°
  status: ProjectStatus;
  currentStep: number;
  pointsUsed: number;
  language: 'ko' | 'en';
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

interface Scene {
  id: string;
  index: number;
  prompt: string;         // ì˜ì–´ ë¹„ì£¼ì–¼ í”„ë¡¬í”„íŠ¸ (í…ìŠ¤íŠ¸ ì—†ìŒ)
  narration: string;      // í•œêµ­ì–´/ì˜ì–´ ë‚´ë ˆì´ì…˜
  duration: number;       // 8ì´ˆ
  approved: boolean;
}

interface VideoClip {
  sceneId: string;
  videoUrl?: string;
  operationId?: string;
  status: 'pending' | 'processing' | 'completed' | 'failed';
}

interface TTSAudio {
  sceneId: string;
  audioUrl?: string;
  duration?: number;
  voice: string;
}

interface Subtitle {
  sceneId: string;
  entries: SubtitleEntry[];
  srtContent?: string;
  assContent?: string;
}

interface SubtitleEntry {
  index: number;
  startTime: number;
  endTime: number;
  text: string;
}
```

---

## ğŸ¬ ë¹„ë””ì˜¤ í”„ë¡¬í”„íŠ¸ ê·œì¹™

### ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­
1. **í•œêµ­ì–´ í…ìŠ¤íŠ¸ í¬í•¨ ê¸ˆì§€** (Hangul, Korean ë‹¨ì–´)
2. **í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ê¸ˆì§€** (text, label, caption, subtitle)
3. **"Korean" ë‹¨ì–´ ì‚¬ìš© ê¸ˆì§€**

### ê¶Œì¥ ì‚¬í•­
- ìˆœìˆ˜ ì‹œê°ì  ë¬˜ì‚¬ë§Œ ì‚¬ìš©
- ì¹´ë©”ë¼ ì•µê¸€, ì¡°ëª…, ë¶„ìœ„ê¸° í¬í•¨
- êµ¬ì²´ì ì¸ ì¥ë©´ ì„¤ëª…
- ì˜ì–´ë¡œë§Œ ì‘ì„±

### ì˜ˆì‹œ
```
âŒ BAD: "Korean text overlay showing product name"
âŒ BAD: "Text in Korean language appears on screen"
âœ… GOOD: "Sleek product shot on white background, soft lighting, slow camera pan"
âœ… GOOD: "Modern office space with natural light, person using laptop, cinematic angle"
```

---

## ğŸµ TTS ê·œì¹™

### ë‚´ë ˆì´ì…˜ ê¸¸ì´
- ìµœì†Œ 40-50ì (8ì´ˆ ì˜ìƒ ê¸°ì¤€)
- í•œêµ­ì–´: ì´ˆë‹¹ 3-4ìŒì ˆ
- ì˜ì–´: ì´ˆë‹¹ 2-3ë‹¨ì–´

### ìŒì„± ì˜µì…˜ (OpenAI TTS)
| ìŒì„± | íŠ¹ì§• |
|------|------|
| alloy | ì¤‘ì„±ì , ê· í˜•ì¡íŒ |
| echo | ë‚¨ì„±ì , ê¹Šì€ |
| fable | ì˜êµ­ì‹ ì–µì–‘ |
| onyx | ë‚¨ì„±ì , ê¶Œìœ„ìˆëŠ” |
| nova | ì—¬ì„±ì , ë¶€ë“œëŸ¬ìš´ |
| shimmer | ì—¬ì„±ì , ë”°ëœ»í•œ |

---

## ğŸ“ ìë§‰ ì‹œìŠ¤í…œ

### ìë§‰ íƒ€ì´ë° ì „ëµ
1. TTS ì˜¤ë””ì˜¤ ê¸¸ì´ ê¸°ë°˜
2. GPTë¡œ ë¬¸ì¥ ìì—°ìŠ¤ëŸ½ê²Œ ë¶„í• 
3. ê° ë¬¸ì¥ 2-4ì´ˆ ê¸¸ì´
4. í•œêµ­ì–´: ì´ˆë‹¹ 3-4ìŒì ˆ ê¸°ì¤€

### ì§€ì› í˜•ì‹
- **SRT**: ê¸°ë³¸ í˜•ì‹
- **ASS**: ìŠ¤íƒ€ì¼ í¬í•¨ (í°íŠ¸, ìƒ‰ìƒ, ìœ„ì¹˜)

### ASS ìŠ¤íƒ€ì¼ ê¸°ë³¸ê°’
```ass
Style: Default,AppleSDGothicNeo-Bold,48,&H00FFFFFF,&H000000FF,&H00000000,&HFF000000,-1,0,0,0,100,100,0,0,1,3,0,2,20,20,40,1
```

### í°íŠ¸ ìš°ì„ ìˆœìœ„
1. AppleSDGothicNeo (macOS)
2. Noto Sans CJK KR (Linux/Windows)
3. NanumGothic (í´ë°±)

---

## ğŸ”„ ë³‘ë ¬ ì²˜ë¦¬

### ë¹„ë””ì˜¤ ìƒì„± (Step 4)
```javascript
// ëª¨ë“  ì”¬ ë™ì‹œ ìš”ì²­
const videoPromises = scenes.map(scene => 
  generateAndWaitForVideo(scene, projectId, token)
);
const results = await Promise.allSettled(videoPromises);
```

### TTS ìƒì„± (Step 5)
```javascript
// ëª¨ë“  ì”¬ ë™ì‹œ TTS ìƒì„±
const ttsPromises = scenes.map(scene =>
  generateTTS(scene.narration, voice, language)
);
const results = await Promise.allSettled(ttsPromises);
```

---

## ğŸ” ì¬ì‹œë„ ë¡œì§

### Veo API ì¬ì‹œë„
```javascript
const maxRetries = 3;
const retryDelays = [30000, 60000, 90000]; // 30ì´ˆ, 60ì´ˆ, 90ì´ˆ

for (let retry = 0; retry <= maxRetries; retry++) {
  try {
    const result = await generateVideo(prompt);
    if (result.success) return result;
  } catch (error) {
    if (retry < maxRetries && isRetryableError(error)) {
      await delay(retryDelays[retry]);
      continue;
    }
    throw error;
  }
}
```

### ì¬ì‹œë„ ëŒ€ìƒ ì—ëŸ¬
- `429 Too Many Requests`
- `503 Service Unavailable`
- `fetch failed`
- `timeout`

---

## ğŸ’° í¬ì¸íŠ¸ ë¹„ìš©

| í•­ëª© | í¬ì¸íŠ¸ |
|------|--------|
| í”„ë¡¬í”„íŠ¸ êµì • | 5 |
| ìŠ¤í¬ë¦½íŠ¸ ìƒì„± | 10 |
| ë¹„ë””ì˜¤ ìƒì„± (ê°œë‹¹) | 50 |
| TTS ìƒì„± (ê°œë‹¹) | 10 |
| ìµœì¢… í•©ì„± | 20 |
| **ì´ (5ê°œ ì”¬ ê¸°ì¤€)** | **335** |

---

## ğŸ“‹ API ì—”ë“œí¬ì¸íŠ¸

### í”„ë¡œì íŠ¸ ê´€ë¦¬
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/project/create` | í”„ë¡œì íŠ¸ ìƒì„± |
| GET | `/api/project/[id]` | í”„ë¡œì íŠ¸ ì¡°íšŒ |

### Step 1: ì…ë ¥
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/input/submit` | ì›ë³¸ í”„ë¡¬í”„íŠ¸ ì €ì¥ |

### Step 2: í”„ë¡¬í”„íŠ¸ êµì •
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/prompt/correct` | GPT í”„ë¡¬í”„íŠ¸ êµì • |
| POST | `/api/prompt/confirm` | êµì • í™•ì¸ |

### Step 3: ìŠ¤í¬ë¦½íŠ¸/ì”¬
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/script/generate` | GPT-5.2 ìŠ¤í¬ë¦½íŠ¸/ì”¬ ìƒì„± |
| POST | `/api/script/confirm` | ì”¬ í™•ì¸ |

### Step 4: ë¹„ë””ì˜¤
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/video/generate` | Veo3 ë¹„ë””ì˜¤ ìƒì„± |
| POST | `/api/video/select` | í´ë¦½ ì„ íƒ |

### Step 5: TTS
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/tts/generate` | TTS ìƒì„± |
| POST | `/api/tts/confirm` | TTS í™•ì¸ |

### Step 6: ìë§‰
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/subtitle/generate` | ìë§‰ ìƒì„± |
| POST | `/api/subtitle/confirm` | ìë§‰ í™•ì¸ |

### Step 7: ìµœì¢… í•©ì„±
| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| POST | `/api/video/final-compose` | FFmpeg ìµœì¢… í•©ì„± |

---

## âœ… êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì™„ë£Œ
- [x] GPT-5.2 ìŠ¤í¬ë¦½íŠ¸ ìƒì„±ê¸° (`gpt-script-scene-generator.ts`)
- [x] ìµœì¢… ë¹„ë””ì˜¤ í•©ì„±ê¸° (`final-video-composer.ts`)
- [x] ë¹„ë””ì˜¤ í”„ë¡¬í”„íŠ¸ì—ì„œ í•œêµ­ì–´ ì œê±°
- [x] ë³‘ë ¬ ì²˜ë¦¬ (ë¹„ë””ì˜¤, TTS)
- [x] ì¬ì‹œë„ ë¡œì§

### ì§„í–‰ ì¤‘
- [ ] ìë§‰ ì—”ì§„ ê°œì„  (TTS ê¸¸ì´ ê¸°ë°˜)
- [ ] ASS í˜•ì‹ ì§€ì›
- [ ] API ë¼ìš°íŠ¸ ì™„ì„±

### ì˜ˆì •
- [ ] í”„ë¡ íŠ¸ì—”ë“œ UI ì—°ë™
- [ ] ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 

---

## ğŸ“Œ ì£¼ì˜ì‚¬í•­

1. **ë°°í¬ ì „ ì‚¬ìš©ì ìŠ¹ì¸ í•„ìˆ˜**
2. **API í‚¤ ì ˆëŒ€ ì»¤ë°‹ ê¸ˆì§€**
3. **Veo API í• ë‹¹ëŸ‰ ì£¼ì˜** (ì¼ì¼ ì œí•œ)
4. **FFmpeg ì„¤ì¹˜ í•„ìš”** (ì„œë²„ í™˜ê²½)
5. **í•œêµ­ì–´ í°íŠ¸ ì„¤ì¹˜ í•„ìš”** (ìë§‰ìš©)

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [06_Reels_Factory_ê¸°ìˆ _ëª…ì„¸ì„œ.md](./06_Reels_Factory_ê¸°ìˆ _ëª…ì„¸ì„œ.md)
- [05_ê°œë°œ_ê°€ì´ë“œ.md](./05_ê°œë°œ_ê°€ì´ë“œ.md)
- [03_ê¸°ìˆ _ëª…ì„¸ì„œ.md](./03_ê¸°ìˆ _ëª…ì„¸ì„œ.md)

