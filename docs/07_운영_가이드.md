# 운영 가이드
# imagesfactory

**문서 버전**: 1.0  
**작성일**: 2025-11-23  
**대상 독자**: 운영팀, 고객지원팀

---

## 📋 개요

본 문서는 imagesfactory 서비스의 일상 운영, 고객 지원, 문제 해결 방법을 안내합니다.

---

## 👥 고객 지원

### 지원 채널

#### 1. 이메일 지원
- **주소**: support@imagesfactory.com
- **응답 시간**: 평일 24시간 이내, 주말 48시간 이내
- **담당**: 고객지원팀

#### 2. 채팅 지원 (향후 추가)
- **시간**: 평일 10:00-18:00
- **도구**: Intercom 또는 채널톡
- **응답 시간**: 5분 이내

#### 3. FAQ
- **위치**: 웹사이트 하단, 대시보드 내
- **관리**: 주 1회 업데이트

#### 4. 커뮤니티 (향후 추가)
- **플랫폼**: 디스코드 또는 오픈카톡
- **운영**: 커뮤니티 매니저

### 문의 유형별 대응

#### 회원가입/로그인 문제

**Q: 회원가입이 안 돼요**
```
1. 이메일 형식 확인
2. 비밀번호 규칙 확인 (최소 6자)
3. 브라우저 쿠키/캐시 삭제 후 재시도
4. 다른 브라우저로 시도
5. 문제 지속 시 Firebase Auth 로그 확인
```

**Q: 로그인이 안 돼요**
```
1. 이메일/비밀번호 확인
2. 비밀번호 재설정 링크 안내
3. 계정 잠금 여부 확인 (5회 실패 시)
4. Firebase Console에서 사용자 확인
```

**Q: 이메일 인증 메일이 안 와요**
```
1. 스팸 메일함 확인 요청
2. 이메일 주소 오타 확인
3. 이메일 재발송 (최대 3회)
4. SendGrid 로그 확인
```

#### 이미지 생성 문제

**Q: 이미지 생성이 실패했어요**
```
1. 프롬프트 내용 확인 (금지어 포함 여부)
2. 포인트 차감 확인
3. 실패 사유 확인 (Firestore failedReason)
4. 포인트 자동 환불 확인
5. 재생성 안내
6. 문제 지속 시 AI API 상태 확인
```

**Q: 이미지 생성이 너무 오래 걸려요**
```
1. 현재 대기열 상태 확인
2. 예상 완료 시간 안내
3. 평균 생성 시간: 30초/장
4. 50장 요청 시 약 25분 소요
```

**Q: 생성된 이미지가 마음에 안 들어요**
```
1. 프롬프트 개선 팁 제공
2. 스타일 변경 제안
3. 재생성 권장
4. 환불 불가 안내 (생성 완료된 경우)
```

#### 포인트/결제 문제

**Q: 포인트가 차감되지 않았어요**
```
1. Firestore에서 pointTransactions 확인
2. 사용자 points 필드 확인
3. 수동 차감 필요 시 Admin SDK 사용
4. 거래 내역 생성
```

**Q: 결제했는데 포인트가 안 들어왔어요**
```
1. 토스페이먼츠 대시보드에서 결제 확인
2. Firestore payments 컬렉션 확인
3. 결제 상태: completed 확인
4. 수동 지급 필요 시 처리
5. 영수증 이메일 재발송
```

**Q: 환불 요청해요**
```
1. 구매일 확인 (7일 이내)
2. 포인트 사용 여부 확인
3. 사용하지 않았다면 승인
4. 토스페이먼츠 환불 API 호출
5. Firestore 업데이트 (payment status: refunded)
6. 포인트 차감
7. 환불 완료 이메일 발송
```

#### 다운로드 문제

**Q: 이미지를 다운로드할 수 없어요**
```
1. Firebase Storage URL 확인
2. 다운로드 권한 확인
3. 링크 만료 여부 확인 (30일)
4. 브라우저 팝업 차단 확인
5. ZIP 파일 재생성 제공
```

**Q: 이메일로 받은 링크가 안 열려요**
```
1. 링크 만료 확인
2. Firebase Storage 권한 확인
3. 새 링크 생성 및 발송
```

---

## 🛠 일상 운영 업무

### 매일 확인 사항

#### 시스템 상태 (오전 9시)
```
□ Firebase 서비스 상태 확인
□ Cloud Functions 에러율 확인
□ 이미지 생성 성공률 확인 (목표: 95% 이상)
□ API 응답 시간 확인 (목표: <500ms)
□ 에러 로그 검토 (Sentry)
```

#### 사용자 지표 (오전 10시)
```
□ 전일 신규 가입자 수
□ 전일 활성 사용자 수 (DAU)
□ 전일 이미지 생성 수
□ 전일 매출
□ 포인트 충전 현황
```

#### 고객 지원 (수시)
```
□ 이메일 문의 확인 및 답변
□ 결제 오류 처리
□ 환불 요청 처리
□ 버그 리포트 수집
```

### 매주 업무 (월요일)

#### 주간 리포트 작성
```
□ 주간 사용자 증가율
□ 주간 매출
□ 주간 생성 이미지 수
□ 인기 프롬프트 키워드 분석
□ 고객 문의 통계
□ 주요 이슈 및 해결 방안
```

#### 데이터 관리
```
□ Firestore 데이터 백업
□ Storage 사용량 확인
□ 오래된 데이터 정리 (90일 이상)
□ 비용 분석
```

### 매월 업무 (1일)

#### 월간 리포트
```
□ 월간 MAU
□ 월간 매출
□ 월간 신규 가입자
□ 유료 전환율
□ 리텐션율
□ NPS 조사
```

#### 재무 관리
```
□ Firebase 청구서 확인
□ AI API 비용 확인
□ 수익/비용 분석
□ 예산 대비 실적
```

---

## 🔧 관리자 기능

### Firebase Console 활용

#### Firestore 데이터 관리

**사용자 조회**
```
1. Firestore > users 컬렉션
2. 특정 사용자 검색 (이메일, UID)
3. 포인트 잔액 확인
4. 생성 히스토리 확인
```

**수동 포인트 지급**
```javascript
// Firebase Console > Firestore
// users/{userId} 문서 수정

// 1. users 문서의 points 필드 업데이트
points: currentPoints + additionalPoints

// 2. pointTransactions 컬렉션에 거래 내역 추가
{
  userId: "user-id",
  amount: 1000,
  type: "bonus",
  description: "고객 보상",
  balanceBefore: currentPoints,
  balanceAfter: currentPoints + 1000,
  createdAt: serverTimestamp()
}
```

**이미지 생성 상태 확인**
```
1. imageGenerations 컬렉션
2. status 필터: processing, failed
3. 오래 걸리는 작업 확인 (30분 이상)
4. 필요 시 재시작 또는 환불
```

#### Authentication 관리

**사용자 계정 관리**
```
1. Authentication > Users
2. 특정 사용자 검색
3. 계정 비활성화/삭제
4. 이메일 인증 상태 확인
5. 비밀번호 재설정 이메일 발송
```

**악의적 사용자 차단**
```
1. Authentication > Users
2. 해당 사용자 선택
3. "Disable user" 클릭
4. Firestore에서 데이터 보존 (증거)
```

#### Storage 관리

**저장소 사용량 확인**
```
1. Storage > Files
2. 용량 확인
3. 오래된 파일 정리 (90일 이상)
4. 미사용 파일 삭제
```

**이미지 URL 재발급**
```
1. 특정 이미지 파일 찾기
2. "Get download URL" 클릭
3. 새 URL 생성
4. 사용자에게 전달
```

### Cloud Functions 관리

**Function 로그 확인**
```bash
# Firebase CLI로 로그 확인
firebase functions:log

# 특정 Function만
firebase functions:log --only processImageGeneration

# 시간 제한
firebase functions:log --only processImageGeneration --limit 100
```

**Function 재배포**
```bash
# 모든 Functions (승인 필요!)
firebase deploy --only functions

# 특정 Function만
firebase deploy --only functions:processImageGeneration
```

---

## 🚨 긴급 상황 대응

### 서비스 장애

#### Level 1: 심각 (서비스 전체 중단)

**대응 절차**:
```
1. 즉시 상황 파악
   - Firebase Console 상태 확인
   - 에러 로그 확인 (Sentry)
   - 외부 API 상태 확인

2. 사용자 공지
   - 웹사이트 배너
   - 소셜 미디어 (트위터, 인스타그램)
   - 이메일 발송 (진행 중인 작업 사용자)

3. 문제 해결
   - 개발팀 긴급 호출
   - 원인 파악 및 수정
   - 테스트 후 재배포

4. 사후 처리
   - 복구 공지
   - 피해 사용자 보상 (포인트 지급)
   - 사고 보고서 작성
```

#### Level 2: 중요 (일부 기능 장애)

**대응 절차**:
```
1. 영향 범위 파악
2. 임시 해결책 안내
3. 빠른 시일 내 수정
4. 업데이트 공지
```

#### Level 3: 경미 (UX 문제, 오타 등)

**대응 절차**:
```
1. 이슈 트래커 등록
2. 다음 배포에 포함
3. 릴리스 노트에 명시
```

### 보안 사고

#### 의심스러운 활동 감지

**징후**:
- 비정상적으로 많은 이미지 생성
- 짧은 시간 내 대량 가입
- API 호출 급증
- 금지된 콘텐츠 생성 시도

**대응**:
```
1. 해당 계정 즉시 정지
2. IP 주소 차단
3. Firestore 보안 규칙 강화
4. 로그 분석
5. 필요 시 경찰 신고
```

#### 데이터 유출 의심

**대응**:
```
1. 즉시 서비스 일시 중단
2. 침해 경로 확인 및 차단
3. 영향 받은 사용자 확인
4. KISA(한국인터넷진흥원) 신고
5. 사용자 공지 (개인정보보호법 준수)
6. 비밀번호 재설정 강제
7. 보안 강화 조치
```

### 대량 환불 요청

**원인**:
- 서비스 장애
- 품질 문제
- 버그로 인한 포인트 손실

**대응**:
```
1. 원인 파악
2. 정당한 요청 확인
3. 일괄 환불 스크립트 실행
4. 사과 공지
5. 추가 보상 (포인트 지급)
6. 재발 방지 대책
```

---

## 📊 데이터 분석 & 모니터링

### 주요 대시보드

#### 1. 사용자 대시보드
- 일일/주간/월간 신규 가입자
- DAU/MAU
- 리텐션 코호트
- 사용자 세그먼트

#### 2. 매출 대시보드
- 일일/주간/월간 매출
- 포인트 판매 현황
- 패키지별 판매량
- ARPU, LTV

#### 3. 서비스 대시보드
- 이미지 생성 수
- 생성 성공률
- 평균 생성 시간
- 인기 스타일/비율

#### 4. 기술 대시보드
- API 응답 시간
- 에러율
- Firebase 사용량
- AI API 비용

### Firebase Analytics 이벤트

**추적 이벤트**:
```typescript
// 회원가입
logEvent('sign_up', { method: 'email' | 'google' });

// 이미지 생성 요청
logEvent('generate_image', {
  image_count: number,
  style: string,
  points_used: number,
});

// 포인트 충전
logEvent('purchase', {
  package_id: string,
  amount: number,
  points: number,
});

// 이미지 다운로드
logEvent('download_image', {
  generation_id: string,
  type: 'single' | 'zip',
});
```

---

## 🔄 정기 유지보수

### 일일
- 로그 모니터링
- 고객 문의 응대
- 시스템 상태 확인

### 주간
- 데이터 백업 확인
- 성능 최적화
- 보안 업데이트 확인

### 월간
- Firebase 비용 분석
- 사용하지 않는 리소스 정리
- 보안 감사
- 백업 복구 테스트

### 분기
- 주요 기능 업데이트
- UX 개선
- 대규모 리팩토링
- 인프라 최적화

---

## 📞 비상 연락망

### 내부 팀
- **개발팀 리드**: [연락처]
- **DevOps**: [연락처]
- **고객지원**: [연락처]
- **대표**: [연락처]

### 외부 파트너
- **Firebase Support**: firebase.google.com/support
- **OpenAI Support**: help.openai.com
- **토스페이먼츠**: 1544-7772
- **SendGrid**: support.sendgrid.com

### 긴급 상황 연락 순서
```
1. 문제 발생자 → 개발팀 리드
2. 개발팀 리드 → DevOps (필요 시)
3. 개발팀 리드 → 대표 (심각한 경우)
4. 고객지원팀 → 사용자 공지
```

---

## 📚 참고 자료

### 내부 문서
- `.cursorrules`: 개발 규칙
- `docs/03_기술_명세서.md`: 기술 스택
- `docs/04_Firebase_설정_가이드.md`: Firebase 설정
- `docs/05_개발_가이드.md`: 개발 가이드

### 외부 문서
- [Firebase 문서](https://firebase.google.com/docs)
- [Next.js 문서](https://nextjs.org/docs)
- [토스페이먼츠 문서](https://docs.tosspayments.com/)
- [OpenAI API 문서](https://platform.openai.com/docs)

---

## ✅ 체크리스트

### 신규 운영자 온보딩
- [ ] Firebase Console 액세스 권한
- [ ] GitHub 저장소 액세스
- [ ] Sentry 액세스
- [ ] 토스페이먼츠 대시보드 액세스
- [ ] 고객지원 이메일 계정
- [ ] 내부 문서 읽기
- [ ] 비상 연락망 저장

### 서비스 출시 전 최종 확인
- [ ] Firebase 프로덕션 설정
- [ ] Firestore 보안 규칙 배포
- [ ] Storage 보안 규칙 배포
- [ ] Cloud Functions 배포
- [ ] 환경 변수 설정
- [ ] 도메인 연결
- [ ] SSL 인증서 설정
- [ ] 이메일 템플릿 설정
- [ ] 결제 테스트 완료
- [ ] 모니터링 도구 설정
- [ ] 백업 시스템 가동
- [ ] 고객지원 준비 완료

---

**문서 히스토리**
- v1.0 (2025-11-23): 초안 작성

